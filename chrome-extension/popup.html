<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Notetaker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            width: 400px;
            height: 500px;
            font-family: 'Inter', sans-serif;
        }
        @import url('https://rsms.me/inter/inter.css');
        /* Custom scrollbar for webkit browsers */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        /* For Firefox */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #94a3b8 #f1f5f9;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div id="app" class="p-6 h-full flex flex-col">
        <!-- Initial View -->
        <div id="initial-view" class="flex flex-col items-center justify-center text-center h-full">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 mb-4"><path d="M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.4z"></path><polyline points="13 2 13 8 19 8"></polyline><path d="m10.4 12.6-2.8 2.8"></path><path d="M10.4 18.4 16 12.8"></path></svg>
            <h1 class="text-lg font-semibold mb-2">What would you like me to note-take today?</h1>
            <p class="text-sm text-slate-500 mb-4">Paste your text below to get started.</p>
            <textarea id="text-input" class="w-full h-32 p-2 border border-slate-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Paste your article, report, or any text here..."></textarea>
            <button id="generate-btn" class="mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors duration-300 disabled:bg-slate-400">
                Generate Notes
            </button>
        </div>

        <!-- Loading View -->
        <div id="loading-view" class="hidden flex-col items-center justify-center text-center h-full">
            <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4 text-slate-600">Analyzing your text and creating notes...</p>
        </div>

        <!-- Results View -->
        <div id="results-view" class="hidden flex-col h-full">
            <div class="flex items-center justify-between mb-4">
                 <h2 class="text-xl font-bold">Your AI-Generated Notes</h2>
                 <button id="back-btn" class="text-sm text-blue-600 hover:underline">Start Over</button>
            </div>
           
            <!-- Tabs -->
            <div class="border-b border-slate-200">
                <nav id="tabs-container" class="-mb-px flex space-x-4" aria-label="Tabs"></nav>
            </div>

            <!-- Tab Panels and Reflection -->
            <div id="panels-container" class="flex-grow overflow-y-auto custom-scrollbar pr-2 -mr-2 mt-4"></div>
             <div id="reflection-container" class="mt-4 pt-4 border-t border-slate-200"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const generateBtn = document.getElementById('generate-btn');
            const backBtn = document.getElementById('back-btn');
            const textInput = document.getElementById('text-input');

            const initialView = document.getElementById('initial-view');
            const loadingView = document.getElementById('loading-view');
            const resultsView = document.getElementById('results-view');

            const tabsContainer = document.getElementById('tabs-container');
            const panelsContainer = document.getElementById('panels-container');
            const reflectionContainer = document.getElementById('reflection-container');
            
            // This is a placeholder for the actual API key.
            // In a real scenario, this should be handled securely.
            const API_KEY = ""; // Leave empty, it will be provided by the environment

            generateBtn.addEventListener('click', async () => {
                const inputText = textInput.value.trim();
                if (!inputText) {
                    alert('Please paste some text into the box.');
                    return;
                }

                // Switch to loading view
                initialView.classList.add('hidden');
                resultsView.classList.add('hidden');
                loadingView.classList.remove('hidden');
                loadingView.classList.add('flex');

                try {
                    const aiResponse = await callGeminiAPI(inputText);
                    renderResults(aiResponse);

                    // Switch to results view
                    loadingView.classList.remove('flex');
                    loadingView.classList.add('hidden');
                    resultsView.classList.remove('hidden');
                    resultsView.classList.add('flex');

                } catch (error) {
                    console.error("Error generating notes:", error);
                    alert("Sorry, something went wrong while generating your notes. Please try again.");
                    // Switch back to initial view on error
                    loadingView.classList.remove('flex');
                    loadingView.classList.add('hidden');
                    initialView.classList.remove('hidden');
                }
            });
            
            backBtn.addEventListener('click', () => {
                // Clear previous results and input
                textInput.value = '';
                tabsContainer.innerHTML = '';
                panelsContainer.innerHTML = '';
                reflectionContainer.innerHTML = '';
                
                // Show initial view
                resultsView.classList.add('hidden');
                resultsView.classList.remove('flex');
                initialView.classList.remove('hidden');
            });

            async function callGeminiAPI(text) {
                // This simulates calling the Chrome's built-in summarizer and prompt API.
                // We'll use the Gemini API to achieve the same result.
                
                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;

                const systemPrompt = `You are an expert note-taking assistant. Your task is to analyze the user's text and provide two things in a specific JSON format:
1.  **Notes**: Summarize the text into organized notes. Group these notes into 3-4 logical sections. Each section must have a short, descriptive title (3-5 words max).
2.  **Reflection**: After creating the notes, write a single, insightful paragraph reflecting on the key themes, takeaways, or implications of the text.

The final output MUST be a single, valid JSON object. Do not include any text before or after the JSON object.

The required JSON structure is:
{
  "notes": [
    {
      "title": "Short Title for Section 1",
      "content": "Bulleted or paragraph notes for section 1..."
    },
    {
      "title": "Short Title for Section 2",
      "content": "Bulleted or paragraph notes for section 2..."
    }
  ],
  "reflection": "Your one-paragraph reflection here..."
}`;
                
                const payload = {
                    contents: [{
                        parts: [{ text: `System Instruction: ${systemPrompt}\n\nUser Text: ${text}` }]
                    }],
                     generationConfig: {
                        responseMimeType: "application/json",
                    }
                };

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const jsonText = result.candidates[0].content.parts[0].text;
                return JSON.parse(jsonText);
            }
            
            function renderResults(data) {
                // Clear any previous results
                tabsContainer.innerHTML = '';
                panelsContainer.innerHTML = '';
                reflectionContainer.innerHTML = '';
                
                // Render Note Tabs and Panels
                data.notes.forEach((note, index) => {
                    // Create Tab
                    const tabButton = document.createElement('button');
                    tabButton.className = `whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200`;
                    tabButton.setAttribute('role', 'tab');
                    tabButton.dataset.targetPanel = `panel-${index}`;
                    
                    const tabTitle = document.createElement('span');
                    tabTitle.contentEditable = "true";
                    tabTitle.className = "px-2 py-1 rounded-md hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500";
                    tabTitle.textContent = note.title;
                    tabButton.appendChild(tabTitle);
                    
                    // Create Panel
                    const panelDiv = document.createElement('div');
                    panelDiv.id = `panel-${index}`;
                    panelDiv.setAttribute('role', 'tabpanel');
                    panelDiv.className = 'text-sm text-slate-700 leading-relaxed prose prose-sm max-w-none';
                    // Sanitize and format content a bit
                    panelDiv.innerHTML = note.content.replace(/\n/g, '<br/>');

                    if (index === 0) {
                        tabButton.classList.add('border-blue-600', 'text-blue-600');
                        tabButton.classList.remove('border-transparent', 'text-slate-500', 'hover:border-slate-300', 'hover:text-slate-700');
                    } else {
                        tabButton.classList.add('border-transparent', 'text-slate-500', 'hover:border-slate-300', 'hover:text-slate-700');
                        panelDiv.classList.add('hidden');
                    }

                    tabsContainer.appendChild(tabButton);
                    panelsContainer.appendChild(panelDiv);
                });
                
                // Add Tab Click Logic
                tabsContainer.addEventListener('click', (e) => {
                    const clickedTab = e.target.closest('button');
                    if (!clickedTab) return;

                    // Deactivate all tabs and hide all panels
                    Array.from(tabsContainer.children).forEach(tab => {
                        tab.classList.remove('border-blue-600', 'text-blue-600');
                        tab.classList.add('border-transparent', 'text-slate-500', 'hover:border-slate-300', 'hover:text-slate-700');
                    });
                    Array.from(panelsContainer.children).forEach(panel => {
                        panel.classList.add('hidden');
                    });
                    
                    // Activate clicked tab
                    clickedTab.classList.add('border-blue-600', 'text-blue-600');
                    clickedTab.classList.remove('border-transparent', 'text-slate-500', 'hover:border-slate-300', 'hover:text-slate-700');
                    
                    // Show corresponding panel
                    const targetPanelId = clickedTab.dataset.targetPanel;
                    document.getElementById(targetPanelId).classList.remove('hidden');
                });


                // Render Reflection
                const reflectionTitle = document.createElement('h3');
                reflectionTitle.className = 'text-md font-semibold mb-2';
                reflectionTitle.textContent = 'AI Reflection';
                
                const reflectionContent = document.createElement('p');
                reflectionContent.className = 'text-sm text-slate-700 leading-relaxed';
                reflectionContent.textContent = data.reflection;

                reflectionContainer.appendChild(reflectionTitle);
                reflectionContainer.appendChild(reflectionContent);
            }
        });
    </script>
</body>
</html>


